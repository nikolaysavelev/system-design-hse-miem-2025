# Решение

## Сервисы

1. **Auth Service** – аутентификация по `playerId`, управление сессиями
2. **Chat Service** – создание комнат, отправка/получение сообщений, история чата
3. **Moderation Service** – удаление сообщений, блокировки, фильтр запрещённых слов
4. **Notification Service** – уведомления о новых сообщениях/действиях модератора
5. **Admin Service** – управление серверами, мониторинг, резервное копирование
6. **Search Service** – поиск чат-комнат по названию/игре
7. **Storage Service** – горячее (30 дней) и холодное хранение сообщений

## Интеграции между сервисами

| Сервис A          | Сервис B           | Способ взаимодействия       | Обоснование |
|-------------------|--------------------|----------------------------|-------------|
| Auth Service      | Все сервисы        | Синхронный (gRPC)          | Проверка `playerId` должна быть быстрой и надежной |
| Chat Service      | Moderation Service | Асинхронный (Kafka)        | Фильтрация запрещенных слов не должна блокировать отправку сообщений |
| Chat Service      | Notification Service | Асинхронный (RabbitMQ)    | Уведомления не критичны к задержке |
| Chat Service      | Storage Service     | Синхронный (HTTP)          | Сохранение сообщений должно подтверждаться сразу |
| Moderation Service | Storage Service    | Синхронный (gRPC)          | Удаление сообщений из хранилища требует подтверждения |
| Frontend          | Chat Service        | Вебсокеты (WS)             | Real-time доставка сообщений |
| Frontend          | Notification Service | SSE (Server-Sent Events)  | Уведомления о блокировках/жалобах |
| Admin Service     | Все сервисы         | HTTP/REST + Prometheus     | Сбор метрик (онлайн, RPS, ошибки) |

## Архитектурная схема (HLD)

```plaintext
┌─────────────┐       ┌──────────────────┐       ┌─────────────────┐
│   Клиент    │──────▶│     Frontend     │──────▶│   Auth Service  │
└─────────────┘       └──────────────────┘       └─────────────────┘
       ▲                      │  ▲
       │ WebSockets           │  │ SSE
       ▼                      ▼  ▼
┌─────────────┐       ┌──────────────────┐       ┌─────────────────┐
│ Chat Service│◀─────▶│ Moderation Svc   │◀─────▶│  Search Service │
└─────────────┘  Kafka└──────────────────┘       └─────────────────┘
       │  │                      ▲                      ▲
       │  │ RabbitMQ             │ HTTP                 │ HTTP
       ▼  ▼                      ▼                      ▼
┌─────────────┐       ┌──────────────────┐       ┌─────────────────┐
│Notification │       │   Storage Svc    │       │   Admin Service │
└─────────────┘       └──────────────────┘       └─────────────────┘
