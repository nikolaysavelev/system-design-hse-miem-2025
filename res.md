### **Домашка 2: Интеграции**  

#### **1. Сервисы на основе ФТ и НФТ**  
1. **Сервис авторизации и аутентификации (Auth)**  
   - Регистрация, вход через сервисы Meta.  
   - Управление правами доступа.  

2. **Сервис поиска людей (Search)**  
   - Поиск по имени, дате, месту рождения, связям (FR1).  
   - Интеграция с Graph API для поиска возможных родственников (FR5).  

3. **Сервис визуализации графа (Graph)**  
   - Отображение генеалогического древа (FR2).  
   - Оптимизация для быстрого рендеринга (<1 сек, NFR3).  

4. **Сервис документов (Documents)**  
   - Загрузка и хранение сканов исторических записей (FR3).  
   - Интеграция с OCR для автоматического распознавания текста.  

5. **Сервис верификации данных (Verification)**  
   - Двойное транскрибирование + модерация (FR4).  
   - Логирование изменений для аудита (NFR5).  

6. **API Gateway**  
   - Единая точка входа для REST/GraphQL API (FR6).  
   - Балансировка нагрузки для масштабируемости (NFR1).  

7. **Сервис уведомлений (Notifications)**  
   - Оповещения о новых родственниках, изменениях в дереве.  

8. **Сервис аудита (Audit)**  
   - Фиксация всех действий пользователей (NFR5).  

---

#### **2. Интеграции и способы взаимодействия**  

| Интеграция | Способ взаимодействия | Обоснование |  
|------------|----------------------|-------------|  
| **Auth ↔ Все сервисы** | Синхронный (HTTP + JWT) | Централизованная проверка прав доступа. |  
| **Search ↔ Meta API** | Синхронный (GraphQL) | Для поиска возможных родственников (FR5). |  
| **Search ↔ Graph** | Асинхронный (Kafka) | Поиск и обновление графа без блокировки UI. |  
| **Documents → Verification** | Асинхронный (S3 + EventBridge) | Очередь на обработку загруженных документов. |  
| **Verification → Graph** | Синхронный (gRPC) | Быстрое обновление данных после верификации. |  
| **API Gateway ↔ Все сервисы** | Синхронный (REST/GraphQL) | Единый интерфейс для клиентов (FR6). |  
| **Notifications ↔ Frontend** | Асинхронный (WebSockets) | Реальные уведомления без polling. |  
| **Все сервисы → Audit** | Асинхронный (Kafka) | Минимизация нагрузки от логгирования. |  

---

#### **3. HLD-схема**  
```  
[Клиент (Web/Mobile)]  
       ↓ (HTTPS)  
[API Gateway] ← REST/GraphQL → [Auth]  
       |  
       ├──→ [Search] ←→ [Meta API]  
       ├──→ [Graph] ← Kafka → [Search]  
       ├──→ [Documents] → S3 → [Verification]  
       ├──→ [Verification] → gRPC → [Graph]  
       ├──→ [Notifications] ← WebSockets → [Клиент]  
       └──→ [Audit] ← Kafka ← [Все сервисы]  
```  

- **Клиент** общается только с API Gateway.  
- **Сервисы** взаимодействуют через оптимальные протоколы (синхронные для критичных операций, асинхронные для фоновых).  
- **Meta API** и **S3** — внешние интеграции.  
- **Аудит** собирает данные из всех сервисов через Kafka.  
