# ДЗ 1

## Kata

**Check Your Work**

A university has greatly expanded its CS course and wants to be able to automate the grading of simple programming assignments.

Users: 300+ students per year, plus staff and admin.

Requirements: Students must be able to upload their source code, which will be run and graded. Grades and runs must be persistent and auditable. There must be a plagiarism detection system involving comparing with other submissions and also submitting to a web-based service (TurnItIn). There must be some level of integration with the University's learning management system (LMS)

## Отсев

Насчёт сроков и показателей успеха в кате ничего не сказано, поэтому предположу следующее:

1. Сроки, скорее всего, большой роли не играют. Из каты понятно, что курс уже запущен и работает, просто разросся и появилась необходимость в автоматизации. Поэтому никто не будет ставить жесткие сроки (курс же и так работает) и срыв сроков не будет чем-то критичным.
2. Основным показателем успеха будет запуск MVP данного сервиса

На стадии Discovery материалы проработаны не очень хорошо:

1. Информация дана очень поверхностная. Не хватает подробностей: как устроен курс и задания в нём, какие платформы и языки необходимо поддерживать и т.д.
2. Плохо описаны требования к интеграциям - не очень понятно что и в каком объеме необходимо передавать в TurnItIn и LMS. Возможно тут вообще нет никакого смысла интегрироваться с TurnItIn - достаточно отображать информацию в LMS. Плюс в России на данный момент вряд ли возможно использовать TurnItIn

Инфраструктура и ресурсы:
В кате об этом нет информации, поэтому предположу что инфра будет университетская (подобная МИЭМу), ресурсы будут в виде команды студентов старших курсов (наподобие МИЭМовской проектной деятельности).

Реалистичность: требования реалистичные, вполне реализуемые в рамках университета.

## Scope Refinement

1. 3 типа пользователей: студент, админ, преподаватель
2. 300-400 пользователей
3. Загрузка ответа на задание (кода); анализ кода и компиляция; запуск кода; прогон тестов; проставление оценки в зависимости от прохождения тестов; возможность просмотра запусков и оценок; проверка на плагиат (сравнение с кодом других студентов); отправка данных в TurnItIn; отправка данных в LMS

## Функциональные требования

1. Я, как студент, хочу, чтобы мои решения автоматически анализировались и проверялись после каждой загрузки. Так я смогу находить ошибки и сразу исправлять их
2. Я, как студент, хочу видеть оценку после каждой загрузки, чтобы иметь возможность доработать решение и получить более высокую оценку
3. Я, как преподаватель, хочу, чтобы решения студентов проверялись автотестами. Так я смогу тратить меньше рабочего времени на проверку ответов
4. Я, как преподаватель, хочу, чтобы ответы студентов проверялись на сходство. Так я смогу снизить вероятность списывания
5. Я, как преподаватель, хочу видеть оценки всех студентов, чтобы учитывать их при проставлении итоговой оценки за курс
6. Я, как преподаватель, хочу иметь возможность добавлять задания, чтобы актуализировать курс
7. Я, как преподаватель, хочу иметь возможность редактировать задания, чтобы актуализировать курс
8. Я, как преподаватель, хочу иметь возможность удалять задания, чтобы актуализировать курс
9. Я, как администратор, хочу иметь возможность добавлять студентов в курс, чтобы актуализировать список обучающихся
10. Я, как администратор, хочу иметь возможность удалять студентов из курса, чтобы актуализировать список обучающихся

## Нефункциональные требования

1. Должен выдерживать нагрузку исходя из того, что на курсе обучается 300-400 студентов и, в теории, они могут единомоментно начать отправлять решения на проверку во время практического занятия или экзамена
2. Систему, скорее всего, в дальнейшем захотят использовать не только для одного курса, а для вообще всех курсов по программированию на факультете. В ВШЭ сейчас около 40000 студентов и 16 факультетов, то есть примерно 2500 студентов на факультет. То есть, необходимо спроектировать систему так, чтобы можно было в дальнейшем нарастить мощность для обслуживания 2500 человек.
3. Необходимо разграничение прав доступа (студент / преподаватель / администратор)
4. В подобные приложения часто добавляют новые функции по типу лидербордов, контестов и т.д., поэтому возможно прирастание еще 2-3 микросервисами
5. UX должен быть простым и понятным, не содержать лишних деталей. Должно быть очевидно, как отправить решение на проверку, как просмотреть результат и оценку, как просмотреть ошибки / свалившиеся тесты. Студент не должен тратить много времени на то, чтобы разобраться как работать с сервисом


## Ограничения

1. Разработка под браузер. Делать мобилку или десктоп нет смысла. Верстать под мобилку также не требуется
2. Развертывание в облаке
3. SLA: поддержка осуществляется по будням в рабочее время
4. География пользователей: Россия, преимущественно город, где находится университет

## Нагрузка

**RPS:**

Сервисом пользуется 300-400 человек. Преподаватели и администраторы работают в течение 8 часов в день. Вряд ли они будут использовать наш сервис все 8 часов, скорее будут обращаться к сервису по мере необходимости. Точное время тут посчитать сложно, но предположим, что это будет около двух часов в день.

Предположим, что всё время обучения на курсе студенты используют наш сервис. Курс, идущий 1 модуль, весит 3 кредита, что равно 114 академическим часам. Один модуль идет в среднем 8 недель. Студенты вряд ли будут каждый день выполнять домашние задания по одному предмету, поэтому предположим, что в среднем они будут обращаться к сервису 3 дня в неделю (в дни занятий). Итого, для полного прохождения курса студентам потребуется использовать сервис в течение дня 114 / (8 * 3) = 5 часов

Студентов у нас будет гораздо больше чем преподавателей. К тому же, именно студенты в основном будут нагружать сервис, запуская на нём проверки домашек. Поэтому возьмем за среднее значение именно данные по студентам.

Также необходимо предположить, сколько запросов будет отправлять один студент в течение дня. Если взять решенные мной задачи с leetcode или аналогичных сервисов, то можно определить, что я добиваюсь прохождения всех тестов со 2 - 15 попытки, в зависимости от сложности задания. В среднем это (2 + 15) / 2 = 9 отправок.

Добавим также всевозможные запросы для получения оценок, просмотра задания и т.д. В основном это обычные GET запросы, их будет явно больше, чем отправок. Точное значение так же посчитать довольно сложно, поэтому предположим, что их будет где-то в 5 раз больше, чем самих отправок.

Итого получаем примерно 50 запросов в день на человека.

400 пользователей × 50 запросов = 20 000 запросов к сервису в день

5 часов * 60 минут * 60 секунд = 18000 секунд в день

20000 / 18000 = 1.11 RPS

**Дисковое пространство:**

Как мы выяснили ранее, у нас имеется до 400 пользователей (с потенциальным ростом до 2500), активны пользователи около трех дней в неделю, в течение дня сервисом пользуются около 5 часов. Студент делает примерно 9 отправок решений в день. Историю каждой отправки (код + результат) необходимо хранить.

Хранить данные бесконечно нет смысла, поэтому после завершения студентом обучения по программе данные можно удалить. Дольше всего реализуются программы бакалавриата - 4 года. Возьмем это значение как максимальный срок хранения данных

Я посмотрел размер файлов с решениями, которые отправлял при решении контестов. В среднем такой файл весит 1-3 Кб. Возьмем среднее - 2Кб. Также добавим 1Кб на хранение результатов проверки. Итого 3Кб

Получается, один пользователь в день сохраняет около 3Кб * 9 отправок = 27Кб данных.

Студенты используют сервис 3 дня в неделю, примерно 52 недели / 3 дня = 156 дней в год.

27 Кб/день * 156 дней * 4 года = 16848 Кб = 17 Мб

Пользователей на данный момент 400, поэтому минимальный объем памяти должен составлять:

17 Мб * 400 пользователей = 7 Гб

Количество пользователей потенциально возрастет до 2500, поэтому максимальный объем памяти:

17 Мб * 2500 пользователей = 43 Гб

Однако помимо проверок мы будем хранить и другие данные (сами задания, тесты, логи, инфа о пользователях и т.д.). Это довольно сложно посчитать, однако вряд ли объем этих данных будет меньше, чем объем самих отправок. Предположим, что их будет как минимум чуть больше, поэтому возьмем цифру в 60Гб для 2500 пользователей. Для 400 пользователей цифра будет ниже, поскольку и заданий будет меньше (всего для 1 курса по CS). Возьмем цифру пропорционально объемам данных для хранения проверок, то есть около 20Гб.

Итого для сервиса нам потребуется изначально около 30 Гб ROM с потенциальным приростом до 110 Гб.
